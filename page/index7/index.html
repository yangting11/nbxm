<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.1/dist/leaflet.css" />
    <script src="../../echarts.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/1.10.0/jquery.min.js"></script>
    <link rel="stylesheet" href="../../layuiadmin/layui/css/layui.css" media="all">
    <link href="./index.css" rel="stylesheet"></link>
    <title>Document</title>
</head>
<body>
    <div id="mapid"></div>
    <div class="rightBox" id="rightBox">
        <div class="rightBoxAll">
            <div class="toogleBox" onclick="clickToogle()">
                <img id="toogleImg" src="../../public/img/left.png" alt="向右">
            </div>
        </div>
    </div>
    <script src="https://unpkg.com/leaflet@1.0.1/dist/leaflet.js"></script>
    <script src="../../layuiadmin/layui/layui.all.js"></script>
    <script>
        var ifOpen=false;
        var layer = layui.layer;
        var map = map;
        initMap();
        function initMap(){
            map = L.map("mapid", {
                center: [37.005646, 114.52044],
                zoom: 11,
                fullscreenControl: false,
                zoomControl: false,
                attributionControl: false
            });
            let baseLayer=L.tileLayer("http://webrd0{s}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=8&x={x}&y={y}&z={z}",{
                subdomains: "1234"
            });
            map.addLayer(baseLayer);
            var marker = L.marker([37, 114.45],{icon:L.icon({iconUrl:'../../public/img/icon.png',iconSize:[28,36]})}).addTo(map).bindTooltip("<div><div>数据数据</div><div class='blueBlock'>#01AAED</div></div>",{permanent:true,opacity:1,direction:'top',offset:[0,50],className:'leaflet-label'}).openTooltip();
            marker.on('click',e=>{
                if($("#chartid").length >0){
                    return
                }
                var popup = L.popup().setLatLng([e.latlng.lat,e.latlng.lng]).setContent(`<div class="popup" style="width:480px;height:330px">
                        <div id="chartid" style="width:500px;height:360px"></div>
                        <div class="closePopup" id="closePopup">
                            <i class="layui-icon layui-icon-close-fill" style="font-size: 30px; color: #1E9FFF;"></i>  </div>
                </div>`);
                map.openPopup(popup)  
                echart();
                $("#closePopup").on('click',function(){
                    map.closePopup();
                })
                map.flyTo([e.latlng.lat,e.latlng.lng],13)
            })     
        }
        function echart() {
            // 基于准备好的dom，初始化echarts实例
            var myChart = echarts.init(document.getElementById("chartid"));
            // 指定图表的配置项和数据
            var index = 0;
            var colorList = ['#f36c6c', '#e6cf4e', '#20d180', '#0093ff'];
            var option = {
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'shadow'
                    }
                },
                legend: {
                    show: false
                },
                grid: {
                    left: 100,
                    top:0,
                    bottom:30
                },
                toolbox: {
                    show: false,
                    feature: {
                        saveAsImage: {}
                    }
                },
                xAxis: {
                    type: 'value',

                    splitLine: {
                        show: false
                    },
                    axisLabel: {
                        show: false
                    },
                    axisTick: {
                        show: false
                    },
                    axisLine: {
                        show: false
                    }

                },
                yAxis: {
                    type: 'category',
                    inverse: true,
                    axisLine: {
                        show: false
                    },
                    axisTick: {
                        show: false
                    },
                    axisPointer: {
                        label: {
                            show: true,
                            margin: 30
                        }
                    },
                    data: ['杭州市', '宁波市', '温州市', '湖州市', '嘉兴市'],
                    axisLabel: {
                        interval:0,
                        margin: 100,
                        fontSize: 14,
                        align: 'left',
                        color: '#333',
                        rich: {
                            a1: {
                                color: '#fff',
                                backgroundColor: colorList[0],
                                width: 30,
                                height: 30,
                                align: 'center',
                                borderRadius: 2
                            },
                            a2: {
                                color: '#fff',
                                backgroundColor: colorList[1],
                                width: 30,
                                height: 30,
                                align: 'center',
                                borderRadius: 2
                            },
                            a3: {
                                color: '#fff',
                                backgroundColor: colorList[2],
                                width: 30,
                                height: 30,
                                align: 'center',
                                borderRadius: 2
                            },
                            b: {
                                color: '#fff',
                                backgroundColor: colorList[3],
                                width: 30,
                                height: 30,
                                align: 'center',
                                borderRadius: 2
                            }
                        },
                        formatter: function(params) {
                            if (index == 5) {
                                index = 0;
                                return
                            }
                            index=index+1;
                            if (index - 1 < 3) {
                                console.log('{a' + index + '|' + index + '}' + '  ' + params)
                                return [
                                    '{a' + index + '|' + index + '}' + '  ' + params
                                ].join('\n')
                            } else {
                                console.log('{b|' + index + '}' + '  ' + params)

                                return [
                                    '{b|' + index + '}' + '  ' + params
                                ].join('\n')
                            }
                        }
                    }
                },
                series: [{
                        z: 2,
                        name: 'value',
                        type: 'bar',
                        data: [3.66, 2.86, 1.82, 1.8, 1.53].map((item, i) => {
                            itemStyle = {
                                color: i > 3 ? colorList[3] : colorList[i]
                            }
                            return {
                                value: item,
                                itemStyle: itemStyle
                            };
                        }),
                        label: {
                            show: true,
                            position: 'right',
                            color: '#333333',
                            fontSize: 14,
                            offset: [10, 0]
                        }
                    }

                ]
            };
            myChart.setOption(option);
        }
        function transTime(time){
            let year = time.getFullYear();
            let month = formatTime(time.getMonth()+1);
            let day = formatTime(time.getDate());
            let hour = formatTime(time.getHours());
            let min = formatTime(time.getMinutes());
            let sec = formatTime(time.getSeconds());
            return year+'-'+month+'-'+day+' '+hour+':'+min+':'+sec
        }
        function formatTime(time){
            return time<10?'0'+time:time
        }
        function clickToogle(){
            if(ifOpen){
                $("#toogleImg").attr('src','../../public/img/left.png')
                $("#rightBox").css('right','-400px')
            }else{
                $("#toogleImg").attr('src','../../public/img/right.png');
                $("#rightBox").css('right','0px')

            }
            ifOpen=!ifOpen;
        }
    </script>
</body>
</html>